use word::snake_to_dash;

use crate::*;

pub(crate) fn cargo_toml_content(
    db: &dyn RustCodeGenQueryGroup,
    main_file: FilePtr,
) -> Arc<String> {
    let package = db.package(main_file).unwrap();
    let package_ident = package.ident;
    let dashed_package_ident = snake_to_dash(&package_ident);
    msg_once!("ad hoc");
    let husky_dir_rel = "../../..";
    Arc::new(format!(
        r#"[package]
name = "{dashed_package_ident}"
version = "0.0.0"
description = "generated by husky compiler"
license = "MIT OR Apache-2.0"
edition = "2021"
rust-version = "1.56"

[dependencies]
tokio = {{ version = "1.19.2", features = ["full"] }}
husky-debugger = {{ path = "{husky_dir_rel}/core/crates/apps/husky-debugger" }}
husky-compile-time = {{ path = "{husky_dir_rel}/core/crates/compile/husky-compile-time" }}
__husky_root = {{ path = "{husky_dir_rel}/core/crates/static/__husky_root" }}


[[bin]]
name = "{dashed_package_ident}-debugger"
path = "src/bin/main.rs"
"#
    ))
}
